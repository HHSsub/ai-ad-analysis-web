# SQL ê¸°ë°˜ YouTube ê´‘ê³  ë¶„ì„ ì‹œìŠ¤í…œ - ë°°í¬ ê°€ì´ë“œ

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

ì´ ì‹œìŠ¤í…œì€ **SQLite ë°ì´í„°ë² ì´ìŠ¤**ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ YouTube ê´‘ê³ ë¥¼ ìˆ˜ì§‘, ë¶„ì„í•˜ê³  Google Driveì— ìë™ ì—…ë¡œë“œí•˜ëŠ” ì™„ì „ ìë™í™” ì‹œìŠ¤í…œì…ë‹ˆë‹¤.

### í•µì‹¬ íŠ¹ì§•
- âœ… **156ê°œ ì „ì²´ íŠ¹ì„±** ì™„ì „ êµ¬í˜„ (ëˆ„ë½ ì—†ìŒ)
- âœ… **SQLite DB ê¸°ë°˜** ì‹¤ì‹œê°„ ë°ì´í„° ê´€ë¦¬
- âœ… **Google Drive ìë™ ë™ê¸°í™”**
- âœ… **ìë™ ìŠ¤ì¼€ì¤„ëŸ¬** (6ì‹œê°„ë§ˆë‹¤ ì‹¤í–‰)
- âœ… **ì—‘ì…€ ë°±ì—… ìœ ì§€** (ê¸°ì¡´ ê¸°ëŠ¥ ë³´ì¡´)

---

## ğŸ“¦ 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
cd /home/ubuntu/projects/ai-ad-analysis-web

# Node.js ì˜ì¡´ì„±
npm install better-sqlite3 axios node-cron

# Python ì˜ì¡´ì„±
pip3 install requests sqlite3
```

---

## ğŸ—„ï¸ 2. ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°

### ìˆ˜ì§‘ DB: `youtube_ads.db`
- Python ìŠ¤í¬ë¦½íŠ¸ê°€ ê´‘ê³  URL ìˆ˜ì§‘ ì‹œ ì‚¬ìš©
- í…Œì´ë¸”: `youtube_ads`, `search_history`, `analysis_queue`

### ë¶„ì„ DB: `youtube_ads_analysis.db`
- Next.js ì›¹ì„œë¹„ìŠ¤ê°€ ë¶„ì„ ê²°ê³¼ ì €ì¥ ì‹œ ì‚¬ìš©
- í…Œì´ë¸”: `video_analysis` (ë©”ì¸), `video_features` (156ê°œ íŠ¹ì„±), `analysis_queue`

ë‘ DBëŠ” **ë…ë¦½ì **ì´ë©°, ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì—°ë™í•©ë‹ˆë‹¤.

---

## âš™ï¸ 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env.local` íŒŒì¼ í™•ì¸:

```bash
# YouTube API
YOUTUBE_API_KEY=your_youtube_api_key

# Gemini AI (ì—¬ëŸ¬ í‚¤ ì§€ì›, ì‰¼í‘œë¡œ êµ¬ë¶„)
GEMINI_API_KEY=key1,key2,key3

# SerpAPI (ê´‘ê³  ìˆ˜ì§‘ìš©)
SERPAPI_KEY=646e6386e54a3e331122aa9460166830bcdbd35c89283b857dcf66901e11db2a

# Google Drive (ì„œë¹„ìŠ¤ ê³„ì •)
GOOGLE_SERVICE_ACCOUNT_CREDENTIALS={"type":"service_account","project_id":"...","private_key":"..."}
GOOGLE_DRIVE_CLIENT_EMAIL=your-service-account@project.iam.gserviceaccount.com
GOOGLE_DRIVE_PRIVATE_KEY="-----BEGIN PRIVATE KEY-----\n...\n-----END PRIVATE KEY-----\n"
GOOGLE_DRIVE_FOLDER_ID=your_drive_folder_id

# ì›¹ì„œë¹„ìŠ¤ URL
WEB_SERVICE_URL=http://localhost:3000
```

---

## ğŸš€ 4. ë¹Œë“œ ë° ì‹¤í–‰

```bash
# ë¹Œë“œ
npm run build

# PM2ë¡œ ì‹¤í–‰
pm2 start ecosystem.config.js

# ë¡œê·¸ í™•ì¸
pm2 logs

# ìƒíƒœ í™•ì¸
pm2 status
```

### PM2 í”„ë¡œì„¸ìŠ¤
1. **web-service**: Next.js ì›¹ ì„œë²„ (í¬íŠ¸ 3000)
2. **auto-scheduler-sql**: ìë™í™” ìŠ¤ì¼€ì¤„ëŸ¬ (6ì‹œê°„ë§ˆë‹¤)

---

## ğŸ“‹ 5. ìˆ˜ë™ ì‹¤í–‰ ë°©ë²•

### ì „ì²´ ì›Œí¬í”Œë¡œìš° (í•œ ë²ˆ ì‹¤í–‰)
```bash
npm run scheduler:once
```

### ê°œë³„ ë‹¨ê³„ ì‹¤í–‰
```bash
# ê´‘ê³  ìˆ˜ì§‘ë§Œ
npm run scheduler:collect

# ë¶„ì„ë§Œ
npm run scheduler:analyze

# Drive ì—…ë¡œë“œë§Œ
npm run scheduler:upload

# ìƒíƒœ í™•ì¸ë§Œ
npm run scheduler:status
```

### ìŠ¤ì¼€ì¤„ëŸ¬ ëª¨ë“œ (ê³„ì† ì‹¤í–‰)
```bash
npm run scheduler:start
```

---

## ğŸ” 6. ë°ì´í„° í™•ì¸ ë°©ë²•

### SQLite DB ì§ì ‘ ì¡°íšŒ
```bash
# ìˆ˜ì§‘ DB
sqlite3 youtube_ads.db "SELECT COUNT(*), analysis_status FROM youtube_ads GROUP BY analysis_status;"

# ë¶„ì„ DB
sqlite3 youtube_ads_analysis.db "SELECT COUNT(*), status FROM video_analysis GROUP BY status;"

# 156ê°œ íŠ¹ì„± ë°ì´í„° í™•ì¸
sqlite3 youtube_ads_analysis.db "SELECT COUNT(*) FROM video_features;"
```

### ì›¹ ì¸í„°í˜ì´ìŠ¤
```
http://your-server-ip:3000
```
- ë©”ì¸ í˜ì´ì§€ ìƒë‹¨ì— DB í†µê³„ ì‹¤ì‹œê°„ í‘œì‹œ
- ìˆ˜ë™ ë¶„ì„ ê¸°ëŠ¥ ì§€ì›

---

## ğŸ“¤ 7. Google Drive ì—°ë™ í™•ì¸

### í…ŒìŠ¤íŠ¸ ì—”ë“œí¬ì¸íŠ¸
```bash
curl http://localhost:3000/api/drive/test
```

### ìˆ˜ë™ ì—…ë¡œë“œ
```bash
curl -X POST http://localhost:3000/api/drive/upload-sql \
  -H "Content-Type: application/json" \
  -d '{"format":"csv"}'
```

### Driveì—ì„œ í™•ì¸
- íŒŒì¼ëª…: `youtube_analysis_YYYY-MM-DD.csv`
- 156ê°œ ì»¬ëŸ¼ ëª¨ë‘ í¬í•¨ í™•ì¸

---

## ğŸ”„ 8. ìë™í™” íë¦„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ìë™ ìŠ¤ì¼€ì¤„ëŸ¬ (6ì‹œê°„ë§ˆë‹¤)                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 1: Python ê´‘ê³  ìˆ˜ì§‘                    â”‚
â”‚  - SerpAPIë¡œ YouTube ê´‘ê³  ê²€ìƒ‰               â”‚
â”‚  - youtube_ads.dbì— ì €ì¥                     â”‚
â”‚  - ì¤‘ë³µ ì œê±° ìë™ ì²˜ë¦¬                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 2: ì›¹ì„œë¹„ìŠ¤ API í˜¸ì¶œ (ë¶„ì„)            â”‚
â”‚  - /api/analyze ì—”ë“œí¬ì¸íŠ¸                   â”‚
â”‚  - YouTube API + Gemini AI                  â”‚
â”‚  - 156ê°œ íŠ¹ì„± ì™„ì „ ì¶”ì¶œ                      â”‚
â”‚  - youtube_ads_analysis.dbì— ì €ì¥            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 3: Google Drive ì—…ë¡œë“œ                 â”‚
â”‚  - CSV í˜•íƒœë¡œ ë‚´ë³´ë‚´ê¸°                       â”‚
â”‚  - Drive APIë¡œ ì—…ë¡œë“œ/ì—…ë°ì´íŠ¸               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  STEP 4: ìƒíƒœ í™•ì¸ ë° ë¡œê¹…                   â”‚
â”‚  - DB í†µê³„ ì¶œë ¥                              â”‚
â”‚  - ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ í™•ì¸                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ› ï¸ 9. íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### DB íŒŒì¼ì´ ì—†ëŠ” ê²½ìš°
```bash
# ìë™ìœ¼ë¡œ ìƒì„±ë˜ì§€ë§Œ, ìˆ˜ë™ ìƒì„±ë„ ê°€ëŠ¥
sqlite3 youtube_ads.db < python_scripts/schema.sql
```

### PM2 í”„ë¡œì„¸ìŠ¤ ì¬ì‹œì‘
```bash
pm2 restart auto-scheduler-sql
pm2 restart web-service
```

### ë¡œê·¸ í™•ì¸
```bash
# PM2 ë¡œê·¸
pm2 logs auto-scheduler-sql --lines 100

# ìŠ¤ì¼€ì¤„ëŸ¬ ì „ìš© ë¡œê·¸
tail -f logs/auto-scheduler-sql.log
```

### DB ì´ˆê¸°í™” (ì£¼ì˜!)
```bash
rm youtube_ads.db youtube_ads_analysis.db
# ë‹¤ìŒ ì‹¤í–‰ ì‹œ ìë™ ì¬ìƒì„±
```

---

## ğŸ“Š 10. ë°ì´í„° êµ¬ì¡°

### video_features í…Œì´ë¸” (156ê°œ íŠ¹ì„±)
```sql
SELECT 
  video_id,
  feature_no,
  feature_category,
  feature_item,
  feature_value
FROM video_features
WHERE video_id = 'VIDEO_ID'
ORDER BY feature_no;
```

### CSV ë‚´ë³´ë‚´ê¸° í˜•íƒœ
```
ID, ì œëª©, URL, ìƒíƒœ, ë¶„ì„ì¼ì‹œ, 1.ì¸ë¬¼ë¶„ì„_ì„±ë³„ì¶”ì •, 2.ì¸ë¬¼ë¶„ì„_ì—°ë ¹ì¶”ì •, ..., 156.ì¢…í•©ë©”íƒ€ë°ì´í„°_ì „ë°˜ì íš¨ê³¼ì„±
```

---

## âœ… 11. ê²€ì¦ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `youtube_ads.db` íŒŒì¼ ìƒì„± í™•ì¸
- [ ] `youtube_ads_analysis.db` íŒŒì¼ ìƒì„± í™•ì¸
- [ ] PM2 í”„ë¡œì„¸ìŠ¤ 2ê°œ ì‹¤í–‰ ì¤‘ (`web-service`, `auto-scheduler-sql`)
- [ ] Google Drive í´ë”ì— CSV íŒŒì¼ ìƒì„± í™•ì¸
- [ ] CSV íŒŒì¼ì— 156ê°œ ì»¬ëŸ¼ ëª¨ë‘ ì¡´ì¬ í™•ì¸
- [ ] ì›¹ í˜ì´ì§€ì—ì„œ DB í†µê³„ ì •ìƒ í‘œì‹œ
- [ ] ë¡œê·¸ íŒŒì¼ì— ì—ëŸ¬ ì—†ìŒ

---

## ğŸ“ 12. ì¶”ê°€ ì°¸ê³ ì‚¬í•­

### ê¸°ì¡´ ì—‘ì…€ ê¸°ëŠ¥
- ë°±ì—… ëª©ì ìœ¼ë¡œ **ìœ ì§€**ë¨
- `src/services/excelService.ts` ê·¸ëŒ€ë¡œ ì¡´ì¬
- SQL ê¸°ë°˜ ì‹œìŠ¤í…œê³¼ ë³‘í–‰ ê°€ëŠ¥

### ì„±ëŠ¥ ìµœì í™”
- SQLiteëŠ” **ì„ë² ë””ë“œ DB**ë¡œ ë³„ë„ ì„œë²„ ë¶ˆí•„ìš”
- ì¸ë±ìŠ¤ ìë™ ìƒì„±ìœ¼ë¡œ ë¹ ë¥¸ ì¿¼ë¦¬
- ë™ì‹œ ì“°ê¸° ì œí•œ ìˆìœ¼ë‚˜, ì´ ì‹œìŠ¤í…œì—ëŠ” ì¶©ë¶„

### í™•ì¥ ê°€ëŠ¥ì„±
- PostgreSQL/MySQLë¡œ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ëŠ¥
- í˜„ì¬ ìŠ¤í‚¤ë§ˆ ê·¸ëŒ€ë¡œ ì´ì‹ ê°€ëŠ¥
- ORM (Prisma ë“±) ë„ì… ê°€ëŠ¥

---

**ëª¨ë“  ì„¤ì •ì´ ì™„ë£Œë˜ë©´ ì‹œìŠ¤í…œì´ ìë™ìœ¼ë¡œ ë™ì‘í•©ë‹ˆë‹¤!** ğŸ‰
